<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShiftMaster - Mobil Uyumlu</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- jsPDF & AutoTable for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Hide scrollbar for cleaner UI but allow functionality */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .custom-scroll::-webkit-scrollbar {
            height: 6px;
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        
        /* Prevent iOS text zoom on inputs */
        input, select, textarea {
            font-size: 16px !important; 
        }

        body {
            /* Prevent pull-to-refresh on mobile to feel more like an app */
            overscroll-behavior-y: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans antialiased fixed inset-0 overflow-hidden">
    <div id="root" class="h-full w-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const IconCalendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const IconUserPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="23" y1="11" x2="17" y2="11"></line></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const IconClock = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>;
        const IconUsers = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;

        // --- UTILITIES ---
        const generateId = () => Math.random().toString(36).substr(2, 9);
        
        const getWeekDates = (startDateStr) => {
            const start = new Date(startDateStr);
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date(start);
                d.setDate(start.getDate() + i);
                dates.push({
                    fullDate: d.toISOString().split('T')[0],
                    displayDate: d.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' }),
                    dayName: d.toLocaleDateString('tr-TR', { weekday: 'short' })
                });
            }
            return dates;
        };

        const defaultEmployees = [
            { id: '1', name: 'Ayşe Yılmaz', role: 'Müdür' },
            { id: '2', name: 'Burak Kaya', role: 'Garson' },
            { id: '3', name: 'Cem Demir', role: 'Aşçı' },
        ];

        // --- COMPONENTS ---

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 backdrop-blur-sm p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-sm overflow-hidden animate-fade-in flex flex-col max-h-[90vh]">
                        <div className="flex justify-between items-center p-4 border-b border-gray-100 bg-gray-50">
                            <h3 className="text-lg font-bold text-gray-800">{title}</h3>
                            <button onClick={onClose} className="p-1 bg-gray-200 rounded-full text-gray-600 hover:bg-gray-300 transition-colors">
                                <IconX />
                            </button>
                        </div>
                        <div className="p-4 overflow-y-auto">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            // -- State --
            const [employees, setEmployees] = useState(() => {
                const saved = localStorage.getItem('shift_employees');
                return saved ? JSON.parse(saved) : defaultEmployees;
            });
            
            const [weekStart, setWeekStart] = useState(() => {
                const d = new Date();
                const day = d.getDay();
                const diff = d.getDate() - day + (day === 0 ? -6 : 1);
                const monday = new Date(d.setDate(diff));
                return monday.toISOString().split('T')[0];
            });

            const [shifts, setShifts] = useState(() => {
                const saved = localStorage.getItem('shift_data');
                return saved ? JSON.parse(saved) : {};
            });

            const [isShiftModalOpen, setIsShiftModalOpen] = useState(false);
            const [isEmployeeModalOpen, setIsEmployeeModalOpen] = useState(false);
            const [activeCell, setActiveCell] = useState(null); 
            
            const [editShiftData, setEditShiftData] = useState({ start: '', end: '', label: '', color: 'blue' });
            const [newEmployeeName, setNewEmployeeName] = useState('');
            const [newEmployeeRole, setNewEmployeeRole] = useState('');

            // -- Effects --
            useEffect(() => { localStorage.setItem('shift_employees', JSON.stringify(employees)); }, [employees]);
            useEffect(() => { localStorage.setItem('shift_data', JSON.stringify(shifts)); }, [shifts]);

            const weekDates = getWeekDates(weekStart);

            const getShift = (empId, date) => shifts[`${empId}_${date}`];

            // -- Handlers --
            const handleCellClick = (empId, date) => {
                const currentShift = getShift(empId, date);
                setActiveCell({ empId, date });
                if (currentShift) {
                    setEditShiftData({ ...currentShift });
                } else {
                    setEditShiftData({ start: '09:00', end: '17:00', label: '', color: 'blue' });
                }
                setIsShiftModalOpen(true);
            };

            const handleSaveShift = () => {
                if (!activeCell) return;
                const key = `${activeCell.empId}_${activeCell.date}`;
                
                if (!editShiftData.start || !editShiftData.end) {
                    alert("Lütfen saatleri giriniz.");
                    return;
                }

                setShifts(prev => ({ ...prev, [key]: { ...editShiftData } }));
                setIsShiftModalOpen(false);
            };

            const handleDeleteShift = () => {
                if (!activeCell) return;
                const key = `${activeCell.empId}_${activeCell.date}`;
                setShifts(prev => {
                    const next = { ...prev };
                    delete next[key];
                    return next;
                });
                setIsShiftModalOpen(false);
            };

            const handleAddEmployee = () => {
                if (!newEmployeeName) return;
                setEmployees(prev => [...prev, { id: generateId(), name: newEmployeeName, role: newEmployeeRole || 'Personel' }]);
                setNewEmployeeName('');
                setNewEmployeeRole('');
                // Keep modal open for faster entry or close it? Let's keep it open but clear inputs
                // Actually user might want to close. Let's close.
                // setIsEmployeeModalOpen(false); 
            };

            const handleRemoveEmployee = (id) => {
                if (confirm('Bu personeli silmek istediğinizden emin misiniz?')) {
                    setEmployees(prev => prev.filter(e => e.id !== id));
                }
            };

            const exportPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ orientation: 'landscape' });

                doc.setFontSize(16);
                doc.text("Haftalik Vardiya", 14, 15);
                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text(`Tarih: ${weekStart}`, 14, 21);

                const tableHeaders = [["Isim", ...weekDates.map(d => `${d.dayName}\n${d.displayDate}`)]];
                
                const tableData = employees.map(emp => {
                    const row = [emp.name];
                    weekDates.forEach(d => {
                        const shift = getShift(emp.id, d.fullDate);
                        row.push(shift ? `${shift.start}-${shift.end}\n${shift.label || ''}` : "");
                    });
                    return row;
                });

                doc.autoTable({
                    head: tableHeaders,
                    body: tableData,
                    startY: 25,
                    theme: 'grid',
                    headStyles: { fillColor: [66, 66, 66], halign: 'center', valign: 'middle' },
                    styles: { fontSize: 8, cellPadding: 2, overflow: 'linebreak', halign: 'center', valign: 'middle' },
                    columnStyles: { 0: { halign: 'left', fontStyle: 'bold', cellWidth: 35 } },
                });

                doc.save(`Vardiya_${weekStart}.pdf`);
            };

            const renderShiftCell = (emp, dateObj) => {
                const shift = getShift(emp.id, dateObj.fullDate);
                const isToday = new Date().toISOString().split('T')[0] === dateObj.fullDate;
                
                let bgClass = "bg-white";
                let borderClass = "border-slate-100";
                
                if (shift) {
                    if (shift.color === 'blue') bgClass = "bg-blue-50 border-blue-200";
                    if (shift.color === 'green') bgClass = "bg-emerald-50 border-emerald-200";
                    if (shift.color === 'yellow') bgClass = "bg-amber-50 border-amber-200";
                    if (shift.color === 'red') bgClass = "bg-rose-50 border-rose-200";
                    borderClass = "border-b border-r";
                } else if (isToday) {
                    bgClass = "bg-slate-50"; 
                }

                return (
                    <td 
                        key={dateObj.fullDate} 
                        onClick={() => handleCellClick(emp.id, dateObj.fullDate)}
                        className={`p-1 border-r border-b ${borderClass} min-w-[105px] h-20 cursor-pointer relative ${bgClass} active:bg-gray-100 transition-colors tap-highlight-transparent`}
                    >
                        {isToday && !shift && <div className="absolute top-1 right-1 w-1.5 h-1.5 rounded-full bg-blue-500"></div>}
                        {shift ? (
                            <div className="flex flex-col h-full justify-center items-center text-center w-full">
                                <span className={`font-bold text-xs ${
                                    shift.color === 'blue' ? 'text-blue-700' : 
                                    shift.color === 'green' ? 'text-emerald-700' :
                                    shift.color === 'yellow' ? 'text-amber-700' : 'text-rose-700'
                                }`}>
                                    {shift.start} - {shift.end}
                                </span>
                                {shift.label && <span className="text-[10px] text-gray-500 mt-0.5 leading-tight truncate w-full px-1">{shift.label}</span>}
                            </div>
                        ) : (
                            <div className="h-full w-full flex items-center justify-center">
                                <span className="text-slate-200 text-xl">+</span>
                            </div>
                        )}
                    </td>
                );
            };

            return (
                <div className="h-full flex flex-col bg-white">
                    {/* Compact Header for Mobile */}
                    <header className="bg-white border-b border-slate-200 px-3 py-3 flex items-center justify-between shrink-0 z-30 shadow-sm">
                        <div className="flex items-center gap-2 overflow-hidden">
                            <div className="bg-blue-600 text-white p-1.5 rounded-lg shrink-0">
                                <IconCalendar />
                            </div>
                            <h1 className="text-lg font-bold text-slate-800 truncate">Vardiya</h1>
                        </div>

                        <div className="flex items-center gap-2">
                             <input 
                                type="date" 
                                value={weekStart} 
                                onChange={(e) => setWeekStart(e.target.value)}
                                className="bg-slate-100 border-none text-xs font-semibold text-slate-700 rounded p-2 outline-none w-32"
                            />
                            
                            <button onClick={() => setIsEmployeeModalOpen(true)} className="p-2 text-slate-600 bg-slate-100 rounded-lg hover:bg-slate-200">
                                <IconUsers />
                            </button>
                            <button onClick={exportPDF} className="p-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 shadow-sm">
                                <IconDownload />
                            </button>
                        </div>
                    </header>

                    {/* Main Content - Sticky Table Magic */}
                    <main className="flex-1 overflow-hidden relative flex flex-col">
                        <div className="flex-1 overflow-auto custom-scroll overscroll-x-contain">
                            <table className="border-collapse w-full">
                                <thead className="bg-slate-50 sticky top-0 z-20 shadow-sm">
                                    <tr>
                                        <th className="p-2 text-left border-b border-r border-slate-200 min-w-[130px] sticky left-0 bg-slate-50 z-20">
                                            <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Ekip</span>
                                        </th>
                                        {weekDates.map(d => {
                                            const isToday = new Date().toISOString().split('T')[0] === d.fullDate;
                                            return (
                                                <th key={d.fullDate} className={`p-2 text-center border-b border-slate-200 min-w-[105px] ${isToday ? 'bg-blue-50' : ''}`}>
                                                    <div className="flex flex-col items-center">
                                                        <span className="text-[10px] font-bold text-slate-400 uppercase">{d.dayName}</span>
                                                        <span className={`text-xs font-bold ${isToday ? 'text-blue-600' : 'text-slate-700'}`}>
                                                            {d.displayDate}
                                                        </span>
                                                    </div>
                                                </th>
                                            )
                                        })}
                                    </tr>
                                </thead>
                                <tbody>
                                    {employees.map(emp => (
                                        <tr key={emp.id}>
                                            <td className="p-3 border-r border-b border-slate-200 bg-white sticky left-0 z-10 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]">
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <div className="font-semibold text-sm text-slate-800 leading-tight">{emp.name}</div>
                                                        <div className="text-[10px] text-slate-500">{emp.role}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            {weekDates.map(d => renderShiftCell(emp, d))}
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {/* Empty State Helper */}
                            <div className="p-8 text-center text-slate-400 text-sm">
                                {employees.length === 0 && "Ekip eklemek için yukarıdaki kullanıcı ikonuna tıkla."}
                            </div>
                        </div>
                    </main>

                    {/* Edit Shift Modal */}
                    <Modal isOpen={isShiftModalOpen} onClose={() => setIsShiftModalOpen(false)} title="Vardiya">
                        <div className="space-y-5">
                            <div className="flex gap-3">
                                <div className="flex-1">
                                    <label className="text-xs font-semibold text-gray-500 uppercase mb-1 block">Başlangıç</label>
                                    <input 
                                        type="time" 
                                        value={editShiftData.start}
                                        onChange={e => setEditShiftData({...editShiftData, start: e.target.value})}
                                        className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-medium outline-none focus:border-blue-500 transition-colors"
                                    />
                                </div>
                                <div className="flex-1">
                                    <label className="text-xs font-semibold text-gray-500 uppercase mb-1 block">Bitiş</label>
                                    <input 
                                        type="time" 
                                        value={editShiftData.end}
                                        onChange={e => setEditShiftData({...editShiftData, end: e.target.value})}
                                        className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-lg font-medium outline-none focus:border-blue-500 transition-colors"
                                    />
                                </div>
                            </div>

                            <div>
                                <label className="text-xs font-semibold text-gray-500 uppercase mb-1 block">Not / Etiket</label>
                                <input 
                                    type="text" 
                                    value={editShiftData.label}
                                    onChange={e => setEditShiftData({...editShiftData, label: e.target.value})}
                                    className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:border-blue-500"
                                    placeholder="örn. Sabah, Mutfak"
                                />
                            </div>

                            <div>
                                <label className="text-xs font-semibold text-gray-500 uppercase mb-2 block">Renk</label>
                                <div className="flex justify-between gap-2">
                                    {['blue', 'green', 'yellow', 'red'].map(c => (
                                        <button 
                                            key={c}
                                            onClick={() => setEditShiftData({...editShiftData, color: c})}
                                            className={`flex-1 h-10 rounded-lg border-2 transition-all ${
                                                editShiftData.color === c ? 'border-gray-500 scale-105 shadow-sm' : 'border-transparent opacity-70'
                                            } ${
                                                c === 'blue' ? 'bg-blue-400' : c === 'green' ? 'bg-emerald-400' : c === 'yellow' ? 'bg-amber-400' : 'bg-rose-400'
                                            }`}
                                        ></button>
                                    ))}
                                </div>
                            </div>

                            <div className="pt-2 flex gap-3">
                                <button onClick={handleDeleteShift} className="flex-1 py-3 border border-red-100 text-red-500 rounded-xl font-medium active:bg-red-50">Sil</button>
                                <button onClick={handleSaveShift} className="flex-[2] py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-200 active:scale-95 transition-transform">Kaydet</button>
                            </div>
                        </div>
                    </Modal>

                    {/* Employee Modal */}
                    <Modal isOpen={isEmployeeModalOpen} onClose={() => setIsEmployeeModalOpen(false)} title="Ekip Yönetimi">
                         <div className="space-y-4">
                            <div className="bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <div className="space-y-3">
                                    <input 
                                        type="text" 
                                        value={newEmployeeName}
                                        onChange={e => setNewEmployeeName(e.target.value)}
                                        className="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm outline-none focus:border-blue-500"
                                        placeholder="Ad Soyad"
                                    />
                                    <input 
                                        type="text" 
                                        value={newEmployeeRole}
                                        onChange={e => setNewEmployeeRole(e.target.value)}
                                        className="w-full p-2 bg-white border border-gray-200 rounded-lg text-sm outline-none focus:border-blue-500"
                                        placeholder="Rol (Garson, vb.)"
                                    />
                                    <button 
                                        onClick={handleAddEmployee}
                                        disabled={!newEmployeeName}
                                        className="w-full py-2 bg-slate-800 text-white rounded-lg text-sm font-medium disabled:opacity-50"
                                    >
                                        Ekle
                                    </button>
                                </div>
                            </div>

                            <div className="max-h-[40vh] overflow-y-auto">
                                <h4 className="text-xs font-bold text-gray-400 uppercase mb-2">Liste</h4>
                                <ul className="space-y-2">
                                    {employees.map(e => (
                                        <li key={e.id} className="flex justify-between items-center p-3 bg-white border border-gray-100 rounded-lg shadow-sm">
                                            <div>
                                                <div className="font-semibold text-sm text-gray-800">{e.name}</div>
                                                <div className="text-xs text-gray-500">{e.role}</div>
                                            </div>
                                            <button onClick={() => handleRemoveEmployee(e.id)} className="text-red-400 p-2">
                                                <IconTrash />
                                            </button>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>